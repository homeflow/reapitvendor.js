(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};window.ReapitVendor={Models:{},Collections:{},Views:{},Routers:{},Template:{},init:function(a){return ReapitVendor.Models.Auth.clearInstance(),this.auth=ReapitVendor.Models.Auth.getInstance(a.wsdl,a.property_id,a.password),this},login:function(){return this.auth.login()},getMarketingStats:function(){var a;return null!=this._marketing_stats?(a=new jQuery.Deferred,a.resolve(this._marketing_stats),a):this.auth.marketingStats().done(function(a){return function(b){return a._marketing_stats=b}}(this))},getMarketingStatsView:function(){var a;return a=new jQuery.Deferred,this.getMarketingStats().done(function(b){return function(b){var c;return c=new ReapitVendor.Views.MarketingStats({model:b}),a.resolve(c)}}(this)),a},getViewings:function(){var a;return null!=this._viewings?(a=new jQuery.Deferred,a.resolve(this._viewings),a):this.auth.viewings().done(function(a){return function(b){return a._viewings=b}}(this))},getViewingsView:function(){var a;return a=new jQuery.Deferred,this.getViewings().done(function(b){return function(b){var c;return c=new ReapitVendor.Views.Viewings({collection:b}),a.resolve(c)}}(this)),a},getProperty:function(){var a;return null!=this._property?(a=new jQuery.Deferred,a.resolve(this._property),a):this.auth.property().done(function(a){return function(b){return console.log(b.toJSON()),a._property=b}}(this))},getPropertyView:function(){var a;return a=new jQuery.Deferred,this.getProperty().done(function(b){return function(b){var c;return c=new ReapitVendor.Views.Property({model:b}),a.resolve(c)}}(this)),a},getVendor:function(){var a;return a=new jQuery.Deferred,null!=this._vendor?(a.resolve(this._vendor),a):(this.auth.vendor().done(function(b){return function(c){return b._vendor=c,a.resolve(c)}}(this)),a)},getVendorView:function(){var a;return a=new jQuery.Deferred,this.getVendor().done(function(b){return function(b){var c;return c=new ReapitVendor.Views.Vendor({model:b}),a.resolve(c)}}(this)),a},getOfficesViews:function(){var a,b;return a=new jQuery.Deferred,b=function(b){return function(){return b.auth.offices().done(function(c){var d;return d=function(){return c=_.map(c.models,function(a){return new ReapitVendor.Views.Office({model:a})})},b._offices||(b._offices=d()),a.resolve(b._offices)})}}(this),null!=this._office_views?a.resolve(this._office_views):b().done(function(a){return function(b){return a._office_views=b}}(this)),a}},ReapitVendor.Template=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.setTemplate=function(a){return this.template=$(a)},c.prototype.render=function(){return null!=this.template.html()&&(this.template=Liquid.parse(this.template.html())),console.log(this.template.render(this.args())),this.$el.html(this.template.render(this.args())),this},c}(Backbone.View)}).call(this),function(){"use strict";var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};ReapitVendor.Models.Negotiator=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.url="",c.prototype.initialize=function(){},c.prototype.defaults={},c.newFromXML=function(a){var b;return b=$($.parseXML(a)).find("Negotiator"),_.tap(new ReapitVendor.Models.Negotiator,function(a){return function(a){var c,d,e,f,g;for(f=b.children(),g=[],d=0,e=f.length;e>d;d++)c=f[d],c=$(c),g.push(a.set(c.prop("tagName").toLowerCase(),c.text()));return g}}(this))},c}(Backbone.Model)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};ReapitVendor.Models.Vendor=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.url="",c.prototype.initialize=function(){},c.prototype.defaults={},c.newFromXML=function(a){var b;return b=$($.parseXML(a)),_.tap(new ReapitVendor.Models.Vendor,function(a){return function(a){var c,d,e,f,g;for(f=b.find("Vendor").children(),g=[],d=0,e=f.length;e>d;d++)c=f[d],c=$(c),g.push(a.set(c.prop("tagName").toLowerCase(),c.text()));return g}}(this))},c}(Backbone.Model)}.call(this),function(){"use strict";var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b},c=[].slice;ReapitVendor.Models.Office=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.url="",d.prototype.initialize=function(){},d.prototype.defaults={},d.newFromXMLSegment=function(a){var b,d,e,f;return e=new jQuery.Deferred,b=new jQuery.Deferred,f=$(a),d=_.tap(new ReapitVendor.Models.Office,function(a){return function(a){var d,e,g,h,i,j,k,l,m,n;for(l=f.children(),n=[],h=0,j=l.length;j>h;h++)if(d=l[h],d=$(d),"negotiator"===d.prop("tagName").toLowerCase()){for(a.set("negotiators",new ReapitVendor.Collections.Negotiators),g=[],m=d.children(),i=0,k=m.length;k>i;i++)e=m[i],e=$(e),g.push(ReapitVendor.Models.Auth.getInstance().negotiator(e.text()));n.push($.when.apply($,g).done(function(){var d;return d=1<=arguments.length?c.call(arguments,0):[],a.set("negotiators",a.get("negotiators").add(d)),b.resolve()}))}else n.push(a.set(d.prop("tagName").toLowerCase(),d.text()));return n}}(this)),b.done(function(a){return function(){return e.resolve(d)}}(this)),e},d}(Backbone.Model)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};ReapitVendor.Models.Property=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.newFromXML=function(a){var b,c,d,e;return b=new jQuery.Deferred,e=$($.parseXML(a)),console.log(this.parseFragment(e.find("Property"))),c=new ReapitVendor.Models.Property(this.parseFragment(e.find("Property"))),d=[this.postProcess(c)],$.when.apply($,d).done(function(a){return function(){return b.resolve(c)}}(this)),b.done(function(){}),b.promise()},c.postProcess=function(a){var b;return b=[],ReapitVendor.Models.Auth.getInstance().negotiator(a.get("negotiator").id).done(function(b){return function(b){return a.set("negotiator",b)}}(this))},c.parseFragment=function(a){var b,c,d,e,f;for(c={},f=$(a).contents(),d=0,e=f.length;e>d;d++){if(b=f[d],3===b.nodeType)return $(b).text();if("item"===b.nodeName.toLowerCase())return this.parseFragment(b);$(b).children()[0]&&"item"===$(b).children()[0].nodeName?c[b.nodeName.toLowerCase()]=_.map($(b).children(),function(a){return function(b){return a.parseFragment(b)}}(this)):c[b.nodeName.toLowerCase()]=this.parseFragment(b)}return c},c}(Backbone.Model)}.call(this),function(){"use strict";var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};ReapitVendor.Models.Viewing=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.url="",c.prototype.initialize=function(){},c.prototype.defaults={},c.newFromXMLSegment=function(a){var b,c;return c=$(a),b=_.tap(new ReapitVendor.Models.Viewing,function(a){return function(a){var b,d,e,f,g;for(f=c.children(),g=[],d=0,e=f.length;e>d;d++)b=f[d],b=$(b),g.push(a.set(b.prop("tagName").toLowerCase(),b.text()));return g}}(this))},c}(Backbone.Model)}.call(this),function(){"use strict";var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};ReapitVendor.Models.MarketingStats=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.url="",c.prototype.initialize=function(){},c.prototype.defaults={},c.newFromXML=function(a){var b;return b=$($.parseXML(a)).find("MarketingStats"),_.tap(new ReapitVendor.Models.MarketingStats,function(a){return function(a){var c,d,e,f,g;for(f=b.children(),g=[],d=0,e=f.length;e>d;d++)c=f[d],c=$(c),g.push(a.set(c.prop("tagName").toLowerCase(),c.text()));return g}}(this))},c}(Backbone.Model)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};ReapitVendor.Views.MarketingStats=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.args=function(){return{marketing_stats:this.model.toJSON()}},c}(ReapitVendor.Template)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};ReapitVendor.Views.Property=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.args=function(){var a;return a={property:this.model.toJSON()},a.property.negotiator=a.property.negotiator.toJSON(),a},c}(ReapitVendor.Template)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};ReapitVendor.Views.Office=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(ReapitVendor.Template)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};ReapitVendor.Views.Vendor=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.args=function(){return{vendor:this.model.toJSON()}},c}(ReapitVendor.Template)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};ReapitVendor.Views.Viewings=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.args=function(){return{viewings:this.collection.toJSON()}},c}(ReapitVendor.Template)}.call(this),function(){"use strict";var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};ReapitVendor.Collections.Negotiators=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(Backbone.Collection)}.call(this),function(){"use strict";var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b},c=[].slice;ReapitVendor.Collections.Offices=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,a),d.newFromXML=function(a){var b,d;return d=$($.parseXML(a)),b=_.map(d.find("Offices>item"),function(a){return ReapitVendor.Models.Office.newFromXMLSegment(a)}),$.when.apply($,b).then(function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],new ReapitVendor.Collections.Offices(a)})},d}(Backbone.Collection)}.call(this),function(){"use strict";var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};ReapitVendor.Collections.Viewings=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.newFromXML=function(a){var b,c;return c=$($.parseXML(a)),b=_.map(c.find("Viewings>item"),function(a){return ReapitVendor.Models.Viewing.newFromXMLSegment(a)}),new ReapitVendor.Collections.Viewings(b)},c}(Backbone.Collection)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(ReapitVendor.Models.Auth,arguments,function(){}))},a.clearInstance=function(){return this._instance=null},a}(),ReapitVendor.Models.Auth=function(a){function b(a,b,c){this.root_url=a,this.property_id=b,this.password=c,this.token="",this.session_id=""}return c(b,a),b.prototype.isLoggedIn=function(){return""!==this.token},b.prototype.negotiator=function(a){var b;return b=new jQuery.Deferred,this.login().done(function(c){return function(){return $.soap({url:c.root_url,method:"GetNegotiator",noPrefix:!0,data:{ID:a,AccessToken:c.token},success:function(a){var c,d;return d=a.toString(),c=ReapitVendor.Models.Negotiator.newFromXML(d),b.resolve(c)}})}}(this)),b.promise()},b.prototype.marketingStats=function(){var a;return a=new jQuery.Deferred,this.login().done(function(b){return function(){return $.soap({url:b.root_url,method:"GetMarketingStats",SOAPHeader:{SessionID:b.session_id},noPrefix:!0,data:{ID:b.property_id,AccessToken:b.token},success:function(b){var c;return c=b.toString(),a.resolve(ReapitVendor.Models.MarketingStats.newFromXML(c))}})}}(this)),a.promise()},b.prototype.viewings=function(){var a;return a=new jQuery.Deferred,this.login().done(function(b){return function(){return $.soap({url:b.root_url,method:"GetViewings",SOAPHeader:{SessionID:b.session_id},noPrefix:!0,data:{ID:b.property_id,AccessToken:b.token},success:function(b){var c;return c=b.toString(),a.resolve(ReapitVendor.Collections.Viewings.newFromXML(c))}})}}(this)),a.promise()},b.prototype.offers=function(){var a;return a=new jQuery.Deferred,this.login().done(function(b){return function(){return $.soap({url:b.root_url,method:"GetOffers",SOAPHeader:{SessionID:b.session_id},noPrefix:!0,data:{ID:b.property_id,AccessToken:b.token},success:function(b){var c;return c=b.toString(),ReapitVendor.Collections.Offers.newFromXML(c).done(function(b){return a.resolve(b)})}})}}(this)),a.promise()},b.prototype.property=function(){var a;return a=new jQuery.Deferred,this.login().done(function(b){return function(){return $.soap({url:b.root_url,method:"GetGeneralProperty",noPrefix:!0,data:{ID:b.property_id,FieldList:["ID, Price, PriceString, Strapline, HouseName, HouseNumber, Address1, Address2, Address3, Address4, Postcode, Latitude, Longitude, AvailableFrom, Status, Tenure, Description, AccommodationSummary, Bedrooms, Receptions, Bathrooms, Room, Type, Style, Situation, Special, Image, Floorplan, EPC, PrintableDetails, Office, Negotiator"]},success:function(b){var c;return c=b.toString(),ReapitVendor.Models.Property.newFromXML(c).done(function(b){return a.resolve(b)})}})}}(this)),a.promise()},b.prototype.login=function(){var a;return a=new jQuery.Deferred,this.session().done(function(b){return function(){var c;return""!==b.token?a.resolve():c=$.soap({url:b.root_url,SOAPHeader:{SessionID:b.session_id},method:"VendorLogin",noPrefix:!0,data:{ID:b.property_id,Password:b.password},success:function(c){var d,e;return e=$.parseXML(c.toString()),d=$(e).find("AccessToken").text(),b.token=d,a.resolve()},error:function(b){return a.reject()}})}}(this)),a.promise()},b.prototype.session=function(){var a,b;return a=new jQuery.Deferred,""!==this.session_id?(a.resolve(),a.promise()):(b=$.soap({url:this.root_url,method:"GetSessionID",noPrefix:!0,data:{},success:function(b){return function(c){var d;return d=$.parseXML(c.toString()),b.session_id=$(d).find("ID").text(),a.resolve()}}(this),error:function(b){return function(b){return a.reject()}}(this)}),a.promise())},b.prototype.vendor=function(){var a;return a=new jQuery.Deferred,this.login().done(function(b){return function(){return $.soap({url:b.root_url,SOAPHeader:{SessionID:b.session_id},method:"GetVendor",noPrefix:!0,data:{ID:b.property_id,AccessToken:b.token},success:function(b){var c,d;return d=b.toString(),c=ReapitVendor.Models.Vendor.newFromXML(d),a.resolve(c)}})}}(this)),a.promise()},b.prototype.offices=function(){var a;return a=new jQuery.Deferred,this.login().done(function(b){return function(){var c;return c=$.soap({url:b.root_url,method:"GetOffices",noPrefix:!0,data:{Fields:"ID, Name, HouseName, HouseNumber, Address1, Address2, Address3, Address4, Postcode, Latitude, Longitude, Telephone, Fax, Email, Image, Negotiator"}}),c.done(function(b,c,d){var e;return e=d.responseText,ReapitVendor.Collections.Offices.newFromXML(e).done(function(b){return a.resolve(b)})})}}(this)),a.promise()},b}(a)}.call(this);